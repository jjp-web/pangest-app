<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Panel de Administrador</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- Header -->
<div th:replace="~{fragments/header :: header}"></div>

<!-- Contenido principal -->
<div class="container my-5">
    <h1 class="mb-4">Bienvenido, Administrador</h1>
    
    
    <h4 class="mb-3">Empresas Registradas</h4>

    
	<table class="table table-hover align-middle">
	  <thead>
	    <tr>
	      <th>ID</th>
	      <th>Nombre</th>
	      <th>Descripción</th>
	      <th>Rubro</th>
	      <th>Acciones</th>
	    </tr>
	  </thead>
	  <tbody>
	    <tr th:each="empresa : ${empresas}" th:id="'empresa-row-' + ${empresa.id}">
	      <td th:text="${empresa.id}">1</td>
	      <td th:text="${empresa.nombre}">Nombre</td>
	      <td th:text="${empresa.descripcion}">Descripción</td>
	      <td th:text="${empresa.rubro}">Rubro</td>
	      <td>
	  
			<button class="btn btn-info btn-sm"
			        th:onclick="'toggleDetalles(' + ${empresa.id} + ')'">
			    Ver
			</button>
			
			<button class="btn btn-warning btn-sm"
			        th:onclick="'toggleEditar(' + ${empresa.id} + ')'">
			    Editar
			</button>
			
			<form th:action="@{'/admin/empresas/' + ${empresa.id} + '/eliminar'}" method="post" style="display:inline;">
			    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
			    <button type="submit" class="btn btn-danger btn-sm"
			            onclick="return confirm('¿Estás seguro de eliminar esta empresa?');">
			        Eliminar
			    </button>
			</form>

	      </td>
	    </tr>
	
	    <!-- FILA DETALLE -->
	    <tr th:each="empresa : ${empresas}" th:id="'detalle-' + ${empresa.id}" style="display: none;">
	      <td colspan="5">
	        <div class="alert alert-secondary">
	          <strong>Detalles:</strong><br>
	          ID: <span th:text="${empresa.id}"></span><br>
	          Nombre: <span th:text="${empresa.nombre}"></span><br>
	          Descripción: <span th:text="${empresa.descripcion}"></span><br>
	          Rubro: <span th:text="${empresa.rubro}"></span><br>
	        </div>
	      </td>
	    </tr>
	
	    <!-- FILA EDITAR -->
	    <tr th:each="empresa : ${empresas}" th:id="'editar-' + ${empresa.id}" style="display: none;">
	      <td colspan="5">
	        <form th:action="@{'/admin/empresas/' + ${empresa.id} + '/editar'}" method="post">
	          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
	          <div class="row g-2">
	            <div class="col-md-3">
	              <input type="text" name="nombre" class="form-control" th:value="${empresa.nombre}" required />
	            </div>
	            <div class="col-md-4">
	              <input type="text" name="descripcion" class="form-control" th:value="${empresa.descripcion}" required />
	            </div>
	            <div class="col-md-3">
	              <input type="text" name="rubro" class="form-control" th:value="${empresa.rubro}" required />
	            </div>
	            <div class="col-md-2">
	              <button type="submit" class="btn btn-success btn-sm">Guardar</button>
	              <button type="button"
					        class="btn btn-secondary btn-sm"
					        th:onclick="'toggleEditar(' + ${empresa.id} + ')'">
					    Cancelar
					</button>
	            </div>
	          </div>
	        </form>
	      </td>
	    </tr>
	  </tbody>
	</table>


    <a href="/admin/crear-empresario" class="btn btn-success mt-3">Crear Nueva Empresa</a>
</div>

</body>



<script th:inline="javascript">
  function toggleDetalles(id) {
    const fila = document.getElementById('detalle-' + id);
    fila.style.display = (fila.style.display === 'none') ? '' : 'none';
  }

  function toggleEditar(id) {
    const fila = document.getElementById('editar-' + id);
    fila.style.display = (fila.style.display === 'none') ? '' : 'none';
  }

</script>


</html>
